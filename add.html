<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Планировщик чтения — добавить книгу</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <style>
    :root {
      color-scheme: light dark;
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --bg: #f8fafc;
      --bg-elevated: #ffffff;
      --text: #0b1020;
      --text-muted: #64748b;
      --border: #e2e8f0;
      --radius: 0.75rem;
      --shadow-soft: 0 4px 6px -1px rgb(0 0 0 / 0.1),
                     0 2px 4px -2px rgb(0 0 0 / 0.1);
      --container: 72rem;
    }

    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; }

    body {
      margin: 0;
      font: 16px/1.6 system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    main { flex: 1; }

    .section, .main {
      padding-inline: clamp(1rem, 0.5rem + 1vw, 2rem);
    }

    .section {
      max-width: var(--container);
      margin-inline: auto;
      margin-block: 1.5rem;
      padding-block: 1.25rem;
      background: var(--bg-elevated);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
    }

    .header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--bg-elevated);
      box-shadow: 0 1px 3px rgba(0,0,0,.1);
      padding-block: 0.75rem;
      padding-inline: 1rem;
      isolation: isolate;
    }

    .header__inner {
      max-width: var(--container);
      margin-inline: auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .logo {
      text-decoration: none;
      font-weight: 700;
      color: var(--primary);
    }

    .nav__list {
      display: flex;
      gap: 0.75rem;
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .nav__link {
      display: block;
      padding: 0.4rem 0.8rem;
      border-radius: 999px;
      border: 2px solid transparent;
      text-decoration: none;
      color: var(--text);
    }

    .nav__link:hover { background: rgba(37,99,235,0.08); }
    .nav__link[aria-current="page"] { background: var(--primary); color: #fff; }

    .skip-link {
      position: absolute;
      inset-inline-start: 1rem;
      inset-block-start: -100%;
      z-index: 1000;
      padding: 0.5rem 0.75rem;
      background: #111;
      color: #fff;
      border-radius: 0.5rem;
      text-decoration: none;
    }

    .skip-link:focus,
    .skip-link:focus-visible {
      inset-block-start: 1rem;
    }

    :focus-visible {
      outline: 3px solid var(--primary);
      outline-offset: 2px;
    }

    a, button, input, textarea, select {
      outline-offset: 2px;
    }

    /* Форма */

    .form__fieldset {
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 1rem;
    }

    .form__group { margin-bottom: 0.8rem; }

    .form__group label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    input, textarea, select {
      width: 100%;
      max-width: 100%;
      border-radius: 0.5rem;
      border: 1px solid var(--border);
      padding: 0.45rem 0.6rem;
      font: inherit;
    }

    input:focus-visible,
    textarea:focus-visible,
    select:focus-visible {
      border-color: var(--primary);
    }

    .form__hint {
      margin: 0.25rem 0 0;
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .form__error {
      margin: 0.25rem 0 0;
      font-size: 0.85rem;
      color: #b91c1c;
    }

    .required { color: #b91c1c; }

    .button {
      display: inline-block;
      padding-inline: 0.9rem;
      padding-block: max(0.45rem, calc((44px - 1em)/2));
      border-radius: 999px;
      border: 1px solid var(--primary);
      background: var(--primary);
      color: #fff;
      text-decoration: none;
      font: inherit;
      cursor: pointer;
      transition: background 0.2s ease, border-color 0.2s ease;
    }

    .button:hover {
      background: var(--primary-dark);
      border-color: var(--primary-dark);
    }

    .visually-hidden {
      position: absolute !important;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0 0 0 0);
      white-space: nowrap;
      border: 0;
    }

    /* Модальное окно */

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.5);
      z-index: 900;
    }

    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 22rem;
      width: 90%;
      background: var(--bg-elevated);
      border-radius: var(--radius);
      box-shadow: 0 10px 30px rgba(0,0,0,.3);
      padding: 1.25rem 1.5rem;
      z-index: 1000;
    }

    .modal:focus {
      outline: 3px solid var(--primary);
      outline-offset: 2px;
    }

    .close-btn {
      position: absolute;
      top: 0.6rem;
      right: 0.6rem;
      border: none;
      background: transparent;
      font-size: 1.2rem;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .section { margin-block: 1rem; }
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0f172a;
        --bg-elevated: #1e293b;
        --text: #e2e8f0;
        --border: #334155;
      }
      body {
        background: var(--bg);
        color: var(--text);
      }
      .section,
      .header {
        background: var(--bg-elevated);
      }
    }

    @media (prefers-reduced-motion: reduce) {
      * {
        animation: none !important;
        transition: none !important;
      }
    }
  </style>
</head>
<body>
<a class="skip-link" href="#main">Перейти к основному содержимому</a>

<div class="page">
  <header class="header">
    <div class="header__inner">
      <a class="logo" href="index.html">Планировщик чтения</a>
      <nav class="nav" aria-label="Основная навигация">
        <ul class="nav__list">
          <li><a class="nav__link" href="index.html">Главная</a></li>
          <li><a class="nav__link" href="list.html">Список книг</a></li>
          <li><a class="nav__link" href="add.html" aria-current="page">Добавить книгу</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main id="main" class="main">
    <section class="section">
      <h1>Добавить книгу в план чтения</h1>
      <p>
        Заполните форму: название книги, дату начала чтения и цель. Все обязательные поля
        помечены звёздочкой.
      </p>

      <form id="book-form" novalidate aria-labelledby="book-form-title">
        <fieldset class="form__fieldset">
          <legend id="book-form-title">Новая книга</legend>

          <div class="form__group">
            <label for="book-title">
              Название книги <span class="required" aria-hidden="true">*</span>
            </label>
            <input
              id="book-title"
              name="title"
              type="text"
              required
              aria-required="true"
              aria-describedby="book-title-error">
            <p id="book-title-error" class="form__error visually-hidden" role="alert">
              Пожалуйста, укажите название книги.
            </p>
          </div>

          <div class="form__group">
            <label for="book-date">
              Дата начала чтения <span class="required" aria-hidden="true">*</span>
            </label>
            <input
              id="book-date"
              name="date"
              type="date"
              required
              aria-required="true"
              aria-describedby="book-date-error">
            <p id="book-date-error" class="form__error visually-hidden" role="alert">
              Укажите дату начала чтения (можно приблизительную).
            </p>
          </div>

          <div class="form__group">
            <label for="book-goal">Цель чтения</label>
            <textarea
              id="book-goal"
              name="goal"
              rows="3"
              aria-describedby="book-goal-hint"></textarea>
            <p id="book-goal-hint" class="form__hint">
              Например: «подготовка к собеседованию», «для отдыха» или «для учёбы».
            </p>
          </div>

          <button type="submit" class="button">
            Добавить книгу
          </button>
        </fieldset>
      </form>
    </section>
  </main>
</div>

<!-- Модальное окно подтверждения -->
<div class="overlay" id="overlay" hidden></div>
<div
  class="modal"
  id="success-modal"
  role="dialog"
  aria-modal="true"
  aria-labelledby="success-title"
  aria-describedby="success-desc"
  tabindex="-1"
  hidden>
  <h2 id="success-title">Книга добавлена в план</h2>
  <p id="success-desc">
    Форма прошла валидацию, книга добавлена в план (в рамках примера — без сохранения данных).
  </p>
  <button
    type="button"
    class="close-btn"
    id="modal-close"
    aria-label="Закрыть уведомление">
    ✕ <span class="visually-hidden">Закрыть</span>
  </button>
</div>

<script>
  (function () {
    const form = document.getElementById('book-form');
    const modal = document.getElementById('success-modal');
    const overlay = document.getElementById('overlay');
    const closeBtn = document.getElementById('modal-close');
    let previousActiveElement = null;

    function toggleError(input, errorId, isValid) {
      const errorEl = document.getElementById(errorId);
      if (!errorEl) return;
      if (!isValid) {
        input.setAttribute('aria-invalid', 'true');
        errorEl.classList.remove('visually-hidden');
      } else {
        input.removeAttribute('aria-invalid');
        errorEl.classList.add('visually-hidden');
      }
    }

    function validateField(input, errorId) {
      let valid = true;
      if (input.hasAttribute('required') && !input.value.trim()) {
        valid = false;
      }
      toggleError(input, errorId, valid);
      return valid;
    }

    function openModal() {
      previousActiveElement = document.activeElement;
      overlay.hidden = false;
      modal.hidden = false;

      document.querySelectorAll('body > :not(#success-modal):not(#overlay)').forEach((el) => {
        if (el !== modal && el !== overlay) {
          el.setAttribute('aria-hidden', 'true');
        }
      });

      modal.focus();
      document.addEventListener('keydown', handleKeydown);
    }

    function closeModal() {
      overlay.hidden = true;
      modal.hidden = true;

      document.querySelectorAll('[aria-hidden="true"]').forEach((el) => {
        el.removeAttribute('aria-hidden');
      });

      if (previousActiveElement && typeof previousActiveElement.focus === 'function') {
        previousActiveElement.focus();
      }

      document.removeEventListener('keydown', handleKeydown);
    }

    function handleKeydown(event) {
      if (event.key === 'Escape') {
        event.preventDefault();
        closeModal();
        return;
      }

      if (event.key === 'Tab') {
        const focusable = modal.querySelectorAll(
          'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
        );
        if (!focusable.length) return;
        const first = focusable[0];
        const last = focusable[focusable.length - 1];

        if (event.shiftKey && document.activeElement === first) {
          event.preventDefault();
          last.focus();
        } else if (!event.shiftKey && document.activeElement === last) {
          event.preventDefault();
          first.focus();
        }
      }
    }

    if (form) {
      form.addEventListener('submit', function (e) {
        e.preventDefault();

        const titleInput = document.getElementById('book-title');
        const dateInput = document.getElementById('book-date');

        const titleValid = validateField(titleInput, 'book-title-error');
        const dateValid = validateField(dateInput, 'book-date-error');

        if (titleValid && dateValid) {
          form.reset();
          openModal();
        }
      });
    }

    if (closeBtn && overlay) {
      closeBtn.addEventListener('click', closeModal);
      overlay.addEventListener('click', closeModal);
    }
  })();
</script>
</body>
</html>